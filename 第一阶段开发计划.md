# 《时光信物》第一阶段开发计划（修订版）
## 核心引擎与架构阶段（第1-3周）

### 项目目标
搭建混合架构的技术骨架：C++后端处理游戏逻辑，JavaScript/Node.js前端负责用户界面和体验优化。实现状态机、事件管理器和数据通信系统。

### 🚀 **技术架构升级亮点**
- **前后端分离**：C++专注游戏逻辑，JavaScript专注用户体验
- **实时通信**：通过WebSocket或命名管道实现前后端通信
- **现代化UI**：利用Web技术栈打造精美的文本冒险界面
- **跨平台兼容**：Web界面天然支持多平台

---

## 一、团队分工与职责

### 1. 后端引擎架构师 (Backend Engine Architect) ⭐**升级角色**
**核心职责：** 搭建C++后端架构，负责游戏逻辑和前后端通信
**第一阶段任务：**
- 设计并实现游戏状态机系统
- 创建事件管理器（观察者模式）
- **新增：建立WebSocket服务器或进程间通信系统**
- **新增：设计前后端API接口规范**
- 建立JSON数据加载系统
- 配置CMake构建系统
- 制定代码规范和Git工作流

**具体交付物：**
```cpp
// 核心文件
src/core/GameEngine.h/.cpp       // 主引擎类
src/core/StateManager.h/.cpp     // 状态机管理器
src/core/EventManager.h/.cpp     // 事件系统
src/core/DataLoader.h/.cpp       // JSON数据加载器
src/core/WebSocketServer.h/.cpp  // 🆕 WebSocket通信服务器
src/core/APIHandler.h/.cpp       // 🆕 前后端API处理器
include/core/GameState.h         // 游戏状态基类接口
include/core/APITypes.h          // 🆕 API数据类型定义
CMakeLists.txt                   // 构建配置
```

### 2. 游戏系统开发者 (Gameplay Developer)
**核心职责：** 实现游戏核心逻辑和玩家系统
**第一阶段任务：**
- 设计并实现Player类及属性系统
- 创建物品系统的类层次结构
- 实现洞察(Insight)系统
- 建立游戏规则引擎
- 设计存档/读档系统接口

**具体交付物：**
```cpp
// 核心文件
src/gameplay/Player.h/.cpp       // 玩家类
src/gameplay/Attribute.h/.cpp    // 属性系统
src/gameplay/Insight.h/.cpp      // 洞察系统
src/gameplay/Item.h/.cpp         // 物品基类
src/gameplay/ItemTypes.h/.cpp    // 具体物品类型
src/gameplay/Inventory.h/.cpp    // 物品栏系统
```

### 3. 前端UI/UX工程师 (Frontend UI/UX Engineer) ⭐**升级角色**
**核心职责：** 使用现代Web技术构建精美的用户界面
**第一阶段任务：**
- 设计并实现基于Web的游戏界面（HTML/CSS/JavaScript）
- 创建与C++后端的通信桥梁（WebSocket客户端）
- 实现响应式设计，支持不同屏幕尺寸
- 设计JSON数据结构规范
- 创建实时UI状态管理系统

**具体交付物：**
```
frontend/
├── index.html                   // 主界面
├── css/
│   ├── main.css                // 主样式
│   ├── themes/                 // 主题系统
│   └── components/             // 组件样式
├── js/
│   ├── main.js                 // 主逻辑
│   ├── gameClient.js          // 与C++通信
│   ├── uiManager.js           // UI状态管理
│   ├── dialogueRenderer.js   // 对话渲染
│   └── components/            // UI组件
└── assets/                     // 前端资源
data/locations.json             // 场景数据结构
data/dialogues.json             // 对话数据结构
```

### 4. 音频与特色功能负责人 (Audio & Features Developer)
**核心职责：** 音频系统和独特游戏功能
**第一阶段任务：**
- 研究并集成SFML音频库
- 设计音频管理器架构
- 创建日记系统框架
- 设计小游戏/谜题系统接口
- 准备音频资源管理系统

**具体交付物：**
```cpp
// 核心文件
src/audio/AudioManager.h/.cpp    // 音频管理器
src/features/Journal.h/.cpp      // 日记系统
src/features/Puzzle.h/.cpp       // 谜题系统基类
src/utils/ResourceManager.h/.cpp // 资源管理器
assets/audio/                    // 音频资源目录结构
```

---

## 二、混合架构设计 🔄

### 1. 整体架构图（前后端分离）
```
TimeArtifacts/
├── backend/                     # 🆕 C++后端
│   ├── src/
│   │   ├── core/               # 核心引擎系统
│   │   ├── gameplay/           # 游戏逻辑系统
│   │   ├── audio/             # 音频系统（后端处理）
│   │   ├── features/          # 特色功能系统
│   │   ├── api/               # 🆕 前后端API
│   │   ├── utils/             # 工具类
│   │   └── main.cpp           # 后端服务器入口
│   ├── include/               # 公共头文件
│   ├── tests/                 # 后端单元测试
│   └── CMakeLists.txt         # 后端构建配置
├── frontend/                   # 🆕 Web前端
│   ├── index.html             # 主界面
│   ├── css/                   # 样式文件
│   ├── js/                    # JavaScript逻辑
│   ├── components/            # UI组件
│   ├── assets/               # 前端资源
│   ├── package.json          # 🆕 Node.js依赖管理
│   └── webpack.config.js     # 🆕 打包配置（可选）
├── shared/                    # 🆕 共享资源
│   ├── data/                 # JSON数据文件
│   └── assets/              # 共享游戏资源
├── docs/                     # 文档
└── README.md                 # 项目说明
```

### 2. 核心类设计

#### GameEngine (主引擎)
```cpp
class GameEngine {
private:
    std::unique_ptr<StateManager> stateManager;
    std::unique_ptr<EventManager> eventManager;
    std::unique_ptr<DataLoader> dataLoader;
    bool isRunning;

public:
    void initialize();
    void run();
    void shutdown();
    void changeState(std::unique_ptr<GameState> newState);
};
```

#### StateManager (状态管理器)
```cpp
class GameState {
public:
    virtual ~GameState() = default;
    virtual void enter() = 0;
    virtual void handleInput(const std::string& input) = 0;
    virtual void update(float deltaTime) = 0;
    virtual void render() = 0;
    virtual void exit() = 0;
};

class StateManager {
private:
    std::unique_ptr<GameState> currentState;
    std::unique_ptr<GameState> nextState;

public:
    void changeState(std::unique_ptr<GameState> newState);
    void update(float deltaTime);
    void render();
    void handleInput(const std::string& input);
};
```

#### EventManager (事件系统)
```cpp
class Event {
public:
    virtual ~Event() = default;
    virtual std::string getType() const = 0;
};

class EventManager {
private:
    std::map<std::string, std::vector<std::function<void(const Event&)>>> subscribers;

public:
    void subscribe(const std::string& eventType, std::function<void(const Event&)> callback);
    void publish(std::unique_ptr<Event> event);
    void unsubscribe(const std::string& eventType, /* callback identifier */);
};
```

---

## 三、第一阶段里程碑

### 第1周末目标（混合架构版）
- **后端架构师**: 完成WebSocket服务器基础框架，定义前后端API规范
- **游戏系统开发者**: 完成Player类基础设计，实现属性系统
- **前端UI工程师**: 完成基础Web界面，实现WebSocket客户端连接
- **音频工程师**: 完成音频系统架构设计，研究Web Audio与SFML集成

### 第2周末目标
- **后端架构师**: 完成事件系统，实现前后端实时通信
- **游戏系统开发者**: 完成物品系统设计，实现洞察系统
- **前端UI工程师**: 完成UI状态管理，实现动态内容渲染
- **音频工程师**: 完成音频管理器，实现基础音效播放

### 第3周末目标（第一阶段完成）
- **所有成员**: 前后端集成测试，用户体验优化
- **演示目标**: 
  - 🌐 Web界面正常启动并显示精美的游戏主界面
  - 🔄 前后端通信稳定，状态同步正常
  - 🎮 玩家可以在Web界面中进行游戏交互
  - 🎨 界面支持主题切换，具备基础动画效果
  - 📱 响应式设计，支持不同屏幕尺寸
  - 🔊 音效系统正常工作
  - 📊 实时显示游戏状态（属性、物品栏等）

---

## 四、技术选型与工具（混合架构版）

### 后端技术栈
- **nlohmann/json**: JSON解析
- **websocketpp**: WebSocket服务器 🆕
- **SFML Audio**: 音频处理
- **CMake**: 构建系统
- **vcpkg**: C++包管理器

### 前端技术栈 🆕
- **Node.js**: 开发工具链
- **Vite**: 快速开发服务器和打包工具
- **TypeScript**: 类型安全（可选）
- **现代CSS**: Grid、Flexbox、动画

### 共享开发工具
- **Git**: 版本控制
- **Visual Studio Code**: 推荐IDE（支持前后端开发）
- **Postman/WebSocket客户端**: API测试工具 🆕

### 编码规范
- C++17标准
- 使用智能指针管理内存
- 遵循RAII原则
- 类名使用PascalCase
- 函数名使用camelCase
- 常量使用UPPER_SNAKE_CASE

---

## 五、风险管控

### 主要风险点
1. **技术学习曲线**: ncurses、SFML等库的学习时间
2. **团队协作**: 不同模块间的接口设计
3. **时间管理**: 功能实现复杂度超出预期

### 应对策略
1. **分阶段实现**: 先用简单方案（如{fmt}），后期升级
2. **接口先行**: 优先定义清晰的模块接口
3. **每日站会**: 保持团队沟通，及时发现问题

---

## 六、下阶段预览

第一阶段完成后，第二阶段将专注于：
- 完整游戏内容填充
- 高级UI实现（ncurses）
- 音频内容集成
- 游戏平衡性调试

这个计划确保团队在有限时间内建立稳固的技术基础，为后续功能扩展奠定基石。
